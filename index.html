<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<body>

<!-- Content will go here -->

<h1>Conway's Game Of Life</h1>

<div id = controls style = "display: flex">

    <div id = "delayControls" style = "margin:10px 5px;">
      Animation Delay (ms): <br>
      <input type="number" id="inputDelay" value="10" onchange="changeDelay()">
    </div>
    
    <div id = "cellSizeControls" style = "margin:10px 5px;">
      Cell size (pixels): <br>
      <input type="number" id="inputCellSize" value="2" onchange="setCanvasSize();">
    </div>
    
    <div id = "boardSizeControls" style = "margin:10px 5px;">
      Board size: <br>
      <input type="number" id="inputBoardSize" value="200" onchange="reset()">
    </div>

</div>

<div id = "ruleControls" style = "display: flex">
    <div id = "buttonTable" style = "margin:10px 5px;">
      <table>
          <tr>
            <td>Number of neighbors</td>
            <td>0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
            <td>6</td>
            <td>7</td>
            <td>8</td>
          </tr>
          <tr>
            <td>Dead cell becomes active</td>
            <td> <input type="checkbox" id="b0"> </td>
            <td> <input type="checkbox" id="b1"> </td>
            <td> <input type="checkbox" id="b2"> </td>
            <td> <input type="checkbox" id="b3" checked> </td>
            <td> <input type="checkbox" id="b4"> </td>
            <td> <input type="checkbox" id="b5"> </td>
            <td> <input type="checkbox" id="b6"> </td>
            <td> <input type="checkbox" id="b7"> </td>
            <td> <input type="checkbox" id="b8"> </td>
          </tr>
          <tr>
            <td>Active cell will stay active</td>
            <td> <input type="checkbox" id="s0"> </td>
            <td> <input type="checkbox" id="s1"> </td>
            <td> <input type="checkbox" id="s2" checked> </td>
            <td> <input type="checkbox" id="s3" checked> </td>
            <td> <input type="checkbox" id="s4"> </td>
            <td> <input type="checkbox" id="s5"> </td>
            <td> <input type="checkbox" id="s6"> </td>
            <td> <input type="checkbox" id="s7"> </td>
            <td> <input type="checkbox" id="s8"> </td>
          </tr>
        </table>
    </div>
    <div id = "updateRule" style = "margin:10px 5px;">
        <br></br>
        <button type="button" onclick="resetRule()">Update rule and restart</button>
        <br></br>
    </div>
</div>

<div id="gameDisplay">
    <canvas id="gameCanvas" width="500" height="500"></canvas>
</div>

<script>
    var boardSize = document.getElementById("inputBoardSize").value | 0;
    var globalBoard = genRandomBoard(boardSize);
    var ruleArr = [ [0,0,0,1,0,0,0,0,0], [0,0,1,1,0,0,0,0,0] ];
    setCanvasSize()
    
    var gameAnimation = setInterval(function(){ renderNextGeneration(); }, document.getElementById("inputDelay").value);
    
    function reset(){
        clearInterval(gameAnimation);
        boardSize = document.getElementById("inputBoardSize").value | 0;
        globalBoard = genRandomBoard(boardSize);
        setCanvasSize()
        
        gameAnimation = setInterval(function(){ renderNextGeneration(); }, document.getElementById("inputDelay").value);
    }
    
    function setCanvasSize(){
        var gameCanvas = document.getElementById("gameCanvas");
        var gameDraw = gameCanvas.getContext("2d");
        var canvasSize = boardSize * document.getElementById("inputCellSize").value + 2;
        gameDraw.canvas.width = canvasSize;
        gameDraw.canvas.height = canvasSize;
    }
    
    function resetRule(){
        for(var i=0; i<9; i++){
            ruleArr[0][i] = (document.getElementById("b"+i).checked) ? 1 : 0;
        }
        for(var i=0; i<9; i++){
            ruleArr[1][i] = (document.getElementById("s"+i).checked) ? 1 : 0;
        }
        reset();
    }
    
    
    function changeDelay (){
        clearInterval(gameAnimation);
        gameAnimation = setInterval(function(){ renderNextGeneration(); }, document.getElementById("inputDelay").value);
    }

    function renderNextGeneration() {
        calcNextGeneration(globalBoard);
        drawBoard(globalBoard);
    }
    
    function calcNextGeneration(){
        globalBoard = nextGeneration(globalBoard);
    }
    
    
    function genRandomBoard(size){
        var out = [];
        for(var i = 0; i < size; i++){
            var tempRow = [];
            for(var j = 0; j < size; j++){
                tempRow.push(Math.floor(2*Math.random()));
            }
            out.push(tempRow);
        }
        return out;
    }
    
    function genBlankBoard(size){
        var out = [];
        for(var i = 0; i < size; i++){
            var tempRow = [];
            for(var j = 0; j < size; j++){
                tempRow.push(0);
            }
            out.push(tempRow);
        }
        return out;
    }
    
    function drawBoard(boardArr) {
        var gameCanvas = document.getElementById("gameCanvas");
        var gameDraw = gameCanvas.getContext("2d");
        var arrSize = boardArr.length;
        var cellSize = document.getElementById("inputCellSize").value;
        var canvasSize = arrSize * cellSize + 2;

        
        gameDraw.beginPath();
        gameDraw.lineWidth="1";
        gameDraw.strokeStyle="blue";
        gameDraw.rect(0,0,canvasSize,canvasSize);
        gameDraw.stroke();
        
        gameDraw.clearRect(1,1,canvasSize-2,canvasSize-2);
        
        gameDraw.fillStyle = "#000000";
        for (var row = 0; row < arrSize; row++){
            for(var col = 0; col < arrSize; col++){
                if (boardArr[row][col] == 1)
                    gameDraw.fillRect(row*cellSize+1, col*cellSize+1, cellSize, cellSize);
            }
        }
    }
    
    
    //arrayClone written by Andrew Ray, can be found at http://blog.andrewray.me/how-to-clone-a-nested-array-in-javascript/
    function arrayClone( arr ) {
        var i, copy;
        if( Array.isArray( arr ) ) {
            copy = arr.slice( 0 );
            for( i = 0; i < copy.length; i++ ) {
                copy[ i ] = arrayClone( copy[ i ] );
            }
            return copy;
        } else if( typeof arr === 'object' ) {
            throw 'Cannot clone array containing an object!';
        } else {
            return arr;
        }
    }
    
    
    

    function nextGeneration(parentBoard){
        var childBoard = genBlankBoard(parentBoard.length);
        var numRows = parentBoard.length;
        var numCols = parentBoard[0].length;
        
        for(var r=0; r<numRows; r++)
            for(var c=0; c<numCols; c++)
                childBoard[r][c] = calcState(r,c,parentBoard);
        
        return childBoard;
    }
    
    function calcState(r,c,arr){
        var state=arr[r][c];
        var neighborSum = getNeighborSum(r,c,arr);
        return ruleArr[state][neighborSum];
    }
    
    function getNeighborSum(row,col,arr){
        var sum = 0;
        for( var r = row-1; r <= row+1; r++ ){
            for( var c = col-1; c <= col+1; c++ ){
                sum += arr[(boardSize + r) % boardSize][(boardSize + c) % boardSize];
            }
        }
        sum -= arr[row][col];
        return sum;
    }
    
</script>

</body>
</html>